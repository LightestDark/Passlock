<!DOCTYPE html>
<html lang="en">
<head>
<title>PassLock</title>
<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
    background: #0d0d0d;
    margin: 0;
    padding: 20px;
    color: #ddd;
}
.wrapper {
    max-width: 1000px;
    margin: auto;
    background: #121212;
    padding: 25px;
    border-radius: 6px;
    border: 1px solid #2a2a2a;
}
h1 {
    text-align: center;
    color: #2ecc71;
    margin-bottom: 8px;
    font-weight: 400;
    letter-spacing: 0.5px;
}
.subtitle {
    text-align: center;
    color: #777;
    font-size: 14px;
    margin-bottom: 30px;
}
.main {
    display: flex;
    gap: 25px;
}
.left, .right {
    flex: 1;
}
.box {
    background: #1a1a1a;
    border: 1px solid #333;
    padding: 22px;
    border-radius: 5px;
    margin-bottom: 18px;
}
h2 {
    color: #2ecc71;
    margin-bottom: 20px;
    font-weight: 500;
    font-size: 18px;
    padding-bottom: 10px;
    border-bottom: 1px solid #2a2a2a;
}
.form-group {
    margin-bottom: 18px;
}
label {
    display: block;
    margin-bottom: 6px;
    color: #aaa;
    font-size: 14px;
}
input, select {
    width: 100%;
    padding: 10px;
    border: 1px solid #3a3a3a;
    border-radius: 4px;
    background: #0f0f0f;
    color: #ddd;
    font-family: inherit;
}
input:focus, select:focus {
    outline: none;
    border-color: #2ecc71;
}
.pass-wrap {
    position: relative;
}
.eye-btn {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    background: transparent;
    border: none;
    color: #777;
    cursor: pointer;
    padding: 4px;
    font-size: 14px;
}
.eye-btn:hover {
    color: #2ecc71;
}
.strength {
    height: 4px;
    background: #2a2a2a;
    margin-top: 8px;
    border-radius: 2px;
}
.strength-bar {
    height: 100%;
    width: 0;
    border-radius: 2px;
    transition: all 0.3s;
}
.buttons {
    display: flex;
    gap: 12px;
    margin-top: 25px;
}
button {
    padding: 11px;
    background: #1e3e1e;
    color: #ddd;
    border: 1px solid #2a5c2a;
    border-radius: 4px;
    cursor: pointer;
    flex: 1;
    font-family: inherit;
    transition: all 0.2s;
}
button:hover {
    background: #2a5c2a;
}
.gen-btn {
    background: #152a15;
}
.gen-btn:hover {
    background: #1e3e1e;
}
.pass-list {
    max-height: 400px;
    overflow-y: auto;
    padding: 8px;
    background: #0f0f0f;
    border: 1px solid #2a2a2a;
    border-radius: 4px;
}
.pass-item {
    background: #1a1a1a;
    border: 1px solid #333;
    padding: 16px;
    margin-bottom: 12px;
    border-radius: 4px;
}
.item-top {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
}
.item-name {
    color: #ddd;
    font-weight: 500;
}
.item-cat {
    background: #1e3e1e;
    padding: 3px 10px;
    border-radius: 12px;
    font-size: 12px;
    color: #7bc67b;
}
.item-user {
    color: #888;
    margin-bottom: 12px;
    font-size: 14px;
}
.item-pass {
    background: #0f0f0f;
    padding: 10px;
    margin-bottom: 12px;
    display: flex;
    justify-content: space-between;
    border-radius: 4px;
    border: 1px solid #333;
}
.pass-dots {
    font-family: 'SF Mono', Monaco, monospace;
    letter-spacing: 1.5px;
    color: #777;
}
.item-actions {
    display: flex;
    gap: 8px;
}
.act-btn {
    padding: 7px 12px;
    background: #1a1a1a;
    border: 1px solid #3a3a3a;
    cursor: pointer;
    font-size: 13px;
    flex: 1;
    border-radius: 4px;
    color: #aaa;
    transition: all 0.2s;
}
.act-btn:hover {
    background: #252525;
}
.show-btn:hover {
    color: #7bc67b;
    border-color: #2a5c2a;
}
.copy-btn:hover {
    color: #7bc67b;
    border-color: #2a5c2a;
}
.del-btn:hover {
    color: #c67b7b;
    border-color: #5c2a2a;
}
.empty {
    text-align: center;
    padding: 40px 20px;
    color: #555;
    font-style: italic;
}
.count {
    background: #1e3e1e;
    color: #7bc67b;
    padding: 3px 10px;
    border-radius: 12px;
    font-size: 12px;
    margin-left: 10px;
}
.msg {
    position: fixed;
    top: 25px;
    right: 25px;
    background: #1e3e1e;
    color: #7bc67b;
    padding: 14px 22px;
    display: none;
    z-index: 1000;
    border-radius: 4px;
    border: 1px solid #2a5c2a;
    box-shadow: 0 4px 12px rgba(0,0,0,0.4);
}
.msg.error {
    background: #3e1e1e;
    color: #c67b7b;
    border-color: #5c2a2a;
}
.setup-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.9);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 2000;
}
.setup-box {
    background: #1a1a1a;
    padding: 28px;
    border-radius: 5px;
    width: 340px;
    border: 1px solid #333;
}
.setup-box h3 {
    margin-top: 0;
    color: #2ecc71;
    font-weight: 500;
}
footer {
    text-align: center;
    margin-top: 30px;
    color: #555;
    font-size: 13px;
}
.forgot-btn {
    width: 100%;
    margin-top: 12px;
    background: #3e1e1e;
    border-color: #5c2a2a;
}
.forgot-btn:hover {
    background: #5c2a2a;
}
::-webkit-scrollbar {
    width: 8px;
}
::-webkit-scrollbar-track {
    background: #0f0f0f;
}
::-webkit-scrollbar-thumb {
    background: #333;
    border-radius: 4px;
}
::-webkit-scrollbar-thumb:hover {
    background: #444;
}
</style>
</head>
<body>
<div class="wrapper">
    <h1>PassLock</h1>
    <div class="subtitle">Secure Password Manager</div>
    
    <div class="main">
        <div class="left">
            <div class="box">
                <h2>Add New Password</h2>
                <div class="form-group">
                    <label>Website</label>
                    <input type="text" id="website" placeholder="example.com">
                </div>
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="username" placeholder="user@example.com">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <div class="pass-wrap">
                        <input type="password" id="password" placeholder="Enter your password">
                        <button class="eye-btn" id="eyeBtn" type="button">üëÅ</button>
                    </div>
                    <div class="strength">
                        <div class="strength-bar" id="strengthBar"></div>
                    </div>
                    <div style="font-size:12px; margin-top:5px;" id="strengthText">Strength: None</div>
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select id="category">
                        <option>Social</option>
                        <option>Email</option>
                        <option>Bank</option>
                        <option>Work</option>
                        <option>Other</option>
                    </select>
                </div>
                <div class="buttons">
                    <button id="saveBtn" type="button">Save Password</button>
                    <button class="gen-btn" id="genBtn" type="button">Generate</button>
                </div>
            </div>
        </div>
        
        <div class="right">
            <div class="box">
                <h2 style="display:inline;">Saved Passwords</h2><span class="count" id="count">0</span>
                <div class="pass-list" id="passList">
                    <div class="empty">No passwords stored yet</div>
                </div>
            </div>
            <button class="forgot-btn" onclick="showForgot()" type="button">Forgot Master Password?</button>
        </div>
    </div>
    
    <footer>All passwords are encrypted and stored locally in your browser</footer>
</div>

<div class="msg" id="msg">Message</div>

<div class="setup-screen" id="masterPrompt">
    <div class="setup-box">
        <h3>Enter Master Password</h3>
        <p style="color:#888; font-size:14px; margin-bottom:20px;">Enter your master password to unlock the vault</p>
        <input type="password" id="masterInput" placeholder="Master password" style="width:100%; padding:10px; margin-bottom:20px;">
        <button onclick="checkMaster()" type="button" style="width:100%;">Unlock Vault</button>
        <button onclick="showForgot()" type="button" style="width:100%; margin-top:10px; background:#333;">Forgot Password?</button>
    </div>
</div>

<div class="setup-screen" id="forgotScreen">
    <div class="setup-box">
        <h3>Reset Master Password</h3>
        <p style="color:#c67b7b; font-size:13px; margin-bottom:15px;"> This will delete ALL stored passwords!</p>
        <input type="password" id="newMasterForgot" placeholder="New master password" style="width:100%; padding:10px; margin:10px 0;">
        <input type="password" id="confirmMasterForgot" placeholder="Confirm new password" style="width:100%; padding:10px; margin-bottom:20px;">
        <button onclick="resetMaster()" type="button" style="width:100%; background:#5c2a2a;">Reset & Delete All</button>
        <button onclick="closeForgot()" type="button" style="width:100%; margin-top:10px; background:#333;">Cancel</button>
    </div>
</div>

<script>
const website = document.getElementById('website');
const username = document.getElementById('username');
const password = document.getElementById('password');
const category = document.getElementById('category');
const saveBtn = document.getElementById('saveBtn');
const genBtn = document.getElementById('genBtn');
const eyeBtn = document.getElementById('eyeBtn');
const passList = document.getElementById('passList');
const count = document.getElementById('count');
const strengthBar = document.getElementById('strengthBar');
const strengthText = document.getElementById('strengthText');
const msg = document.getElementById('msg');
const masterPrompt = document.getElementById('masterPrompt');
const forgotScreen = document.getElementById('forgotScreen');
const masterInput = document.getElementById('masterInput');
const newMasterForgot = document.getElementById('newMasterForgot');
const confirmMasterForgot = document.getElementById('confirmMasterForgot');

let masterKey = null;
let passwords = [];
let unlocked = false;

window.addEventListener('DOMContentLoaded', function() {
    if (!localStorage.getItem('hasMaster')) {
        let pass = prompt("Create a master password (minimum 4 characters):");
        if (!pass || pass.length < 4) {
            alert("Please enter at least 4 characters");
            location.reload();
            return;
        }
        
        let confirmPass = prompt("Confirm master password:");
        if (pass !== confirmPass) {
            alert("Passwords don't match");
            location.reload();
            return;
        }
        
        let hash = 0;
        for (let i = 0; i < pass.length; i++) {
            hash = ((hash << 5) - hash) + pass.charCodeAt(i);
        }
        localStorage.setItem('masterHash', hash.toString());
        localStorage.setItem('hasMaster', 'true');
        masterKey = pass;
        unlocked = true;
        showMsg('Master password set successfully');
    } else {
        masterPrompt.style.display = 'flex';
    }
    
    let saved = localStorage.getItem('encryptedPasswords');
    passwords = saved ? JSON.parse(saved) : [];
    updateList();
    
    eyeBtn.addEventListener('click', function() {
        if (password.type === 'password') {
            password.type = 'text';
            eyeBtn.textContent = '--';
        } else {
            password.type = 'password';
            eyeBtn.textContent = 'üëÅ';
        }
    });
    
    password.addEventListener('input', function() {
        let p = this.value;
        let score = 0;
        if (p.length >= 8) score++;
        if (/[a-z]/.test(p)) score++;
        if (/[A-Z]/.test(p)) score++;
        if (/[0-9]/.test(p)) score++;
        if (/[^A-Za-z0-9]/.test(p)) score++;
        
        let color = '#e74c3c';
        let text = 'Weak';
        if (score > 3) {
            color = '#2ecc71';
            text = 'Strong';
        } else if (score > 1) {
            color = '#f39c12';
            text = 'Medium';
        }
        
        strengthBar.style.width = (score * 20) + '%';
        strengthBar.style.backgroundColor = color;
        strengthText.textContent = 'Strength: ' + text;
        strengthText.style.color = color;
    });
    
    genBtn.addEventListener('click', function() {
        const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%';
        let pass = '';
        pass += chars[Math.floor(Math.random() * 26)];
        pass += chars[Math.floor(Math.random() * 26) + 26];
        pass += chars[Math.floor(Math.random() * 10) + 52];
        pass += chars[Math.floor(Math.random() * 5) + 62];
        
        for (let i = 0; i < 8; i++) {
            pass += chars[Math.floor(Math.random() * chars.length)];
        }
        
        pass = pass.split('').sort(() => Math.random() - 0.5).join('');
        password.value = pass;
        password.dispatchEvent(new Event('input'));
        password.type = 'text';
        eyeBtn.textContent = '--';
    });
    
    saveBtn.addEventListener('click', function() {
        if (!unlocked) {
            showMsg('Please unlock the vault first', 'error');
            masterPrompt.style.display = 'flex';
            return;
        }
        
        let web = website.value.trim();
        let user = username.value.trim();
        let pass = password.value.trim();
        let cat = category.value;
        
        if (!web || !user || !pass) {
            showMsg('Please fill all fields', 'error');
            return;
        }
        
        let encrypted = encrypt(pass, masterKey);
        
        passwords.push({
            id: Date.now(),
            website: web,
            username: user,
            password: encrypted,
            category: cat
        });
        
        localStorage.setItem('encryptedPasswords', JSON.stringify(passwords));
        updateList();
        
        website.value = '';
        username.value = '';
        password.value = '';
        password.type = 'password';
        eyeBtn.textContent = 'üëÅ';
        strengthBar.style.width = '0';
        strengthText.textContent = 'Strength: None';
        strengthText.style.color = '';
        
        showMsg('Password saved successfully');
    });
});

function encrypt(text, key) {
    let result = '';
    for (let i = 0; i < text.length; i++) {
        result += String.fromCharCode(text.charCodeAt(i) ^ key.charCodeAt(i % key.length));
    }
    return btoa(result);
}

function decrypt(encrypted, key) {
    try {
        let decoded = atob(encrypted);
        let result = '';
        for (let i = 0; i < decoded.length; i++) {
            result += String.fromCharCode(decoded.charCodeAt(i) ^ key.charCodeAt(i % key.length));
        }
        return result;
    } catch(e) {
        return null;
    }
}

function updateList() {
    if (!unlocked) {
        passList.innerHTML = '<div class="empty"> Vault is locked - enter master password</div>';
        count.textContent = '?';
        return;
    }
    
    count.textContent = passwords.length;
    
    if (passwords.length === 0) {
        passList.innerHTML = '<div class="empty">No passwords saved yet</div>';
        return;
    }
    
    let html = '';
    passwords.forEach(p => {
        html += `
        <div class="pass-item">
            <div class="item-top">
                <div class="item-name">${escapeHtml(p.website)}</div>
                <div class="item-cat">${escapeHtml(p.category)}</div>
            </div>
            <div class="item-user">${escapeHtml(p.username)}</div>
            <div class="item-pass">
                <span class="pass-dots" id="pass-${p.id}"> Encrypted</span>
                <button class="act-btn show-btn" onclick="showPassword(${p.id})" type="button">Show</button>
            </div>
            <div class="item-actions">
                <button class="act-btn copy-btn" onclick="copyPassword(${p.id})" type="button">Copy</button>
                <button class="act-btn del-btn" onclick="deletePassword(${p.id})" type="button">Delete</button>
            </div>
        </div>`;
    });
    passList.innerHTML = html;
}

function showPassword(id) {
    if (!unlocked) {
        showMsg('Please unlock the vault first', 'error');
        return;
    }
    
    let p = passwords.find(x => x.id === id);
    if (!p) return;
    
    let elem = document.getElementById('pass-' + id);
    let btn = elem.nextElementSibling;
    
    if (elem.textContent === ' Encrypted') {
        let decrypted = decrypt(p.password, masterKey);
        elem.textContent = decrypted || '[error]';
        btn.textContent = 'Hide';
        
        setTimeout(() => {
            if (elem.textContent !== ' Encrypted') {
                elem.textContent = ' Encrypted';
                btn.textContent = 'Show';
            }
        }, 5000);
    } else {
        elem.textContent = ' Encrypted';
        btn.textContent = 'Show';
    }
}

function copyPassword(id) {
    if (!unlocked) {
        showMsg('Please unlock the vault first', 'error');
        return;
    }
    
    let p = passwords.find(x => x.id === id);
    if (!p) return;
    
    let decrypted = decrypt(p.password, masterKey);
    if (!decrypted) return;
    
    navigator.clipboard.writeText(decrypted).then(() => {
        showMsg('Password copied to clipboard');
    });
}

function deletePassword(id) {
    if (!unlocked) return;
    
    if (confirm('Are you sure you want to delete this password?')) {
        passwords = passwords.filter(p => p.id !== id);
        localStorage.setItem('encryptedPasswords', JSON.stringify(passwords));
        updateList();
        showMsg('Password deleted');
    }
}

function checkMaster() {
    let entered = masterInput.value;
    let savedHash = localStorage.getItem('masterHash');
    
    let hash = 0;
    for (let i = 0; i < entered.length; i++) {
        hash = ((hash << 5) - hash) + entered.charCodeAt(i);
    }
    
    if (hash.toString() === savedHash) {
        masterKey = entered;
        unlocked = true;
        masterPrompt.style.display = 'none';
        masterInput.value = '';
        updateList();
        showMsg('Vault unlocked successfully');
    } else {
        showMsg('Incorrect password', 'error');
        masterInput.select();
    }
}

function showForgot() {
    masterPrompt.style.display = 'none';
    forgotScreen.style.display = 'flex';
}

function closeForgot() {
    forgotScreen.style.display = 'none';
    masterPrompt.style.display = 'flex';
}

function resetMaster() {
    let newPass = newMasterForgot.value;
    let confirmPass = confirmMasterForgot.value;
    
    if (!newPass || newPass !== confirmPass) {
        showMsg('Passwords do not match', 'error');
        return;
    }
    
    if (!confirm('This will delete ALL saved passwords. Are you sure?')) {
        return;
    }
    
    localStorage.removeItem('encryptedPasswords');
    
    let hash = 0;
    for (let i = 0; i < newPass.length; i++) {
        hash = ((hash << 5) - hash) + newPass.charCodeAt(i);
    }
    localStorage.setItem('masterHash', hash.toString());
    localStorage.setItem('hasMaster', 'true');
    
    masterKey = newPass;
    unlocked = true;
    passwords = [];
    
    forgotScreen.style.display = 'none';
    newMasterForgot.value = '';
    confirmMasterForgot.value = '';
    
    updateList();
    showMsg('Master password reset. All passwords deleted.', 'error');
}

function showMsg(text, type) {
    msg.textContent = text;
    msg.className = 'msg' + (type === 'error' ? ' error' : '');
    msg.style.display = 'block';
    setTimeout(() => {
        msg.style.display = 'none';
    }, 2500);
}

function escapeHtml(text) {
    let div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}
</script>
</body>
</html>
